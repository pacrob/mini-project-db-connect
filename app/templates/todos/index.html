{% extends "base.html" %}

{% block title %}Todo App{% endblock %}

{% block content %}
  <section class="card">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <h2>Create a new task</h2>
    <form method="post" action="{{ url_for('todos.create_todo') }}">
      <label for="title">Title</label>
      <input id="title" name="title" type="text" placeholder="What needs to be done?" required />

      <label for="description">Description <span style="font-weight: normal; opacity: 0.7;">(optional)</span></label>
      <textarea id="description" name="description" placeholder="Add any extra context for the task."></textarea>

      <button type="submit">Add Task</button>
    </form>
  </section>

  <section style="margin-top: 1.5rem;">
    <h2>Existing tasks</h2>
    {% if todos %}
      <ul class="todo-list">
        {% for todo in todos %}
          <li class="{% if todo.is_done %}todo-done{% endif %}">
            <div class="todo-content">
              <p class="todo-title">{{ todo.title }}</p>
              {% if todo.description %}
                <p class="todo-description">{{ todo.description }}</p>
              {% endif %}
              <p class="todo-meta">
                Created {{ todo.created_at.strftime("%b %d, %Y %I:%M %p %Z") }}
              </p>
            </div>
            <div class="todo-actions">
              <form method="post" action="{{ url_for('todos.toggle_todo', todo_id=todo.id) }}">
                <input type="hidden" name="is_done" value="0" />
                <input
                  type="checkbox"
                  name="is_done"
                  value="1"
                  {% if todo.is_done %}checked{% endif %}
                  onchange="this.form.submit()"
                  aria-label="Mark '{{ todo.title }}' as done"
                />
              </form>
              <form method="post" action="{{ url_for('todos.delete_todo_html', todo_id=todo.id) }}" onsubmit="return confirm('Delete this task?');">
                <button type="submit" class="delete-button">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="empty-state">
        <p>No tasks yet. Add your first task above!</p>
      </div>
    {% endif %}
  </section>
{% endblock %}
